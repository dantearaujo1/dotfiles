#URL References I used to create this config:
# http://mutelight.org/articles/practical-tmux
# https://bbs.archlinux.org/viewtopic.php?id=84157
# http://blog.hawkhost.com/2010/06/28/tmux-the-terminal-multiplexer/
# http://blog.hawkhost.com/2010/07/02/tmux-%E2%80%93-the-terminal-multiplexer-part-2/
# http://cheasy.de/tmux.pdf
# http://www.edschmalzle.com/2010/09/29/getting-into-tmux/
# http://tonkersten.com/2011/07/104-switching-to-tmux/
# http://www.linuxized.com/2010/05/switching-from-gnu-screen-to-tmux/
# https://wiki.archlinux.org/index.php/Tmux
# https://chadaustin.me/2024/02/tmux-config/
# https://hamvocke.com/blog/a-guide-to-customizing-your-tmux-conf/
# https://github.com/hamvocke/dotfiles/blob/master/tmux/.tmux.conf

## Shortcuts to remember
# Ctrl+a is the 'prefix' / control key
# ctrl+a ?	- displays custom help (clean, searchable shortcut list)
# ctrl+a ctrl+a - switches between last active window
# ctrl+a ,      - renames current window
# ctrl+a |      - splits window vertically
# ctrl+a \      - splits window vertically (alternative)
# ctrl+a -      - splits window horizontally
# ctrl+a q      - displays numbers on each pane.  Press the number to go to that pane
# ctrl+a o      - cycle through panes -- [Create a new Session]
# ctrl+a ctrl+o - cycle panes into the pane you're currently viewing -- [ Do nothing ]
# ctrl+a n,p    - next/previous windows same as screen -- [ Do nothing, Open floax ]
# ctrl+a <space>- changes default layout of your panes (even-horiz, even-vert, etc) -- [ Do nothing ]
# ctrl+a alt+arrowkeys - resizes current window pane in the direction of the arrow key
# ctrl+a [      - enter copy mode
# ctrl+a a <com>- sends <com> to nested screen or tmux session
# ctrl+a x      - kill a pane(or window)
# ctrl+a w/W    - fzf window switcher popup (replaces default window list) -- [ Do nothing ]
# ctrl+a "      - choose window (interactive window selector)
# ctrl+a s/S    - fzf session switcher popup (replaces default session list) -- [ Session changer ]
# ctrl+a : new -s <session name> - create a new session
# ctrl+a R      - reload / source .tmux.conf
# ctrl+a ,      - rename current window
# ctrl+a k      - kill window -- [ Go to the net pane ]
# ctrl+a m      - turn on/off monitor_activity for a window(useful for irssi)
# ctrl+a M      - toggle mouse mode -- [ Do nothing ]
# ctrl+a X	- break pane to its own window
# ctrl+a j	- bring a window in to current window as a pane (ie: join-pane 0:1)
# ctrl+a T <pos>- move current window to position <pos>
# ctrl+left	- move current window one spot to the left
# ctrl+right	- move current window one spot to the right
# ctrl+a u   	- copy the current window/pane and pipe it to urlview to grab all the urls -- [ Do nothing ]
# ctrl+a z      - Zoom into the current pane, press again to zoom back out (useful for copying text)
# ctrl+a c-c    - create new window after current window -- [ Do nothing ]
# shift+left/right - move current window left/right and follow it -- [ Do nothing ]
#
## Alt key shortcuts (no prefix needed)
# ctrl+a 1-9       - switch to window 1-9
# ctrl+h/j/k/l   - navigate panes (vim-style: left/down/up/right)
# alt+n/m       - navigate panes (left/right) -- [ Do nothing ]
#
## Shell shortcuts (work outside tmux too)
# ctrl+r        - atuin+fzf history search (popup in tmux, regular fzf outside)
#
## Commands to remember
# :setw synchronize-panes [on|off] - Synchronize panes on the current window, sends input to all of them at the same time.
# :movew -r - Renumber (compact) all windows to fill in gaps.  Can also use movew <num> to renumber the current window to <num>.

set -s extended-keys on
set -as terminal-features 'xterm*:extkeys'
# better prefix key
unbind C-Space
unbind C-a
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# bind syncronization of panes
bind C-x setw synchronize-panes

# better splitting
bind | split-window -h -c '#{pane_current_path}'
bind \\ split-window -fh -c "#{pane_current_path}"
unbind \"
unbind C-i
bind - split-window -v -c "#{pane_current_path}"
bind "_" split-window -fv -c "#{pane_current_path}"
unbind %

# Quickly Swap Windows
bind -r "<" swap-window -d -t -1
bind -r ">" swap-window -d -t +1

# Quickly source it
bind r source-file ~/.tmux.conf \: display 'Reloading our tmux configuration!'
# Set path to not go to our home path
bind c new-window -c '#{pane_current_path}'
bind C command-prompt -p "Window name:" "new-window; rename-window '%%'"
bind o command-prompt -p "Session name:" "new-session -s '%%'"
bind O command-prompt -p "Session rename:" "rename-session '%%'"


# Pane Management ===========================================================
# Resizing Pane
bind -r C-down resize-pane -D 15
bind -r C-up resize-pane -U 15
bind -r C-left resize-pane -L 15
bind -r C-right resize-pane -R 15


is_vim="ps -o state= -o comm= -t '#{pane_tty}' \ | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
is_fzf="ps -o state= -o comm= -t '#{pane_tty}' \ | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?fzf$'"

# bind -n C-s run "($is_vim && tmux send-keys C-s) || \ tmux set-window-option synchronize-panes"
bind -n C-h run "($is_vim && tmux send-keys C-h) || \ tmux select-pane -L"

bind -n C-j run "($is_vim && tmux send-keys C-j)  || \ ($is_fzf && tmux send-keys C-j) || \ tmux select-pane -D"

bind -n C-k run "($is_vim && tmux send-keys C-k) || \ ($is_fzf && tmux send-keys C-k)  || \ tmux select-pane -U"

bind -n C-l run  "($is_vim && tmux send-keys C-l) || \ tmux select-pane -R"

bind-key -n C-\\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

# NAVI CHEAT SHEET
bind-key -N "Open Navi (cheat sheets)" -T prefix C-g split-window \
  "$SHELL --login -i -c 'navi --print | head -n 1 | tmux load-buffer -b tmp - ; tmux paste-buffer -p -t {last} -b tmp -d'"

# unbind C-l
# unbind C-j
# unbind C-k
# unbind C-h
# Window Management =========================================================
bind k next-window
bind j previous-window

unbind n
unbind p


# Some key that i don't want to use inside vim
unbind C-v
bind-key -n C-v send-keys C-v

bind-key C-l send-keys C-u
# bind-key -n C-g run-shell -b "tmux send-keys 'lazygit' C-m"
bind-key -n C-v send-keys C-v
bind-key b set-option status # toogle statusbar

unbind C-j
bind-key -n C-p send-keys C-p
bind-key -n C-i send-keys C-i
# Increase History
set -g history-limit 5000

# Escape Time for VIM
set -sg escape-time 5

# Numbering Windows and Panes
set -g base-index 1
setw -g pane-base-index 1


# POPUPS
# bind-key s display-popup -E -w 81% -h 60% "tmux list-sessions -F '#{session_name}: #{session_windows} windows#{?session_attached, (attached),}' | fzf --prompt='Switch to session: ' | cut -d: -f1 | xargs -I {} tmux switch-client -t {}"
# bind-key S display-popup -E -w 80% -h 60% "tmux list-sessions -F '#{session_name}: #{session_windows} windows#{?session_attached, (attached),}' | fzf --prompt='Switch to session: ' | cut -d: -f1 | xargs -I {} tmux switch-client -t {}"
# bind-key w display-popup -E -w 80% -h 60% "tmux list-windows -F '#{window_index}: #{window_name}#{?window_active, (active),}' | fzf --prompt='Switch to window: ' | cut -d: -f1 | xargs -I {} tmux select-window -t {}"
# bind-key W display-popup -E -w 80% -h 60% "tmux list-windows -F '#{window_index}: #{window_name}#{?window_active, (active),}' | fzf --prompt='Switch to window: ' | cut -d: -f1 | xargs -I {} tmux select-window -t {}"

## lazygit popup
bind-key g display-popup -E -xC -yC -w 95% -h 95% -d "#{pane_current_path}" lazygit
## Help
unbind ?
bind-key  ? display-popup -E -w 90% -h 80% "echo 'TMUX SHORTCUTS:
Window/Session Management:
  ctrl+a w/W    - fzf window switcher popup
  ctrl+a s/S    - fzf session switcher popup
  ctrl+a \"      - choose window (interactive)
  ctrl+a ctrl+a - switch to last active window
  ctrl+a ,      - rename current window

Pane Management:
  ctrl+a |      - split window vertically
  ctrl+a -      - split window horizontally
  ctrl+a z      - zoom/unzoom current pane
  ctrl+a X      - break pane to new window
  ctrl+a j      - join pane from another window

Quick Navigation:
  alt+1-9       - switch to window 1-9
  alt+h/j/k/l   - navigate panes (vim-style)

Other Shortcuts:
  ctrl+a g      - lazygit popup
  ctrl+a C      - Claude Code popup (persistent session)
  ctrl+a R      - reload tmux config
  ctrl+r        - atuin+fzf history search
  shift+left/right - move window left/right
' | nvimpager"

bind-key "T" run-shell "sesh connect \"$(
  sesh list --icons | fzf-tmux -p 80%,70% \
    --no-sort --ansi --border-label ' sesh ' --prompt '‚ö°  ' \
    --header '  ^a all ^t tmux ^g configs ^x zoxide ^d tmux kill ^f find' \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-a:change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --preview-window 'right:55%' \
    --preview 'sesh preview {}'
)\""

set-option -g bell-action any
set-option -g set-titles on
set-option -g set-titles-string '#H:#S.#I.#P #W #T' # window number,program name,active (or not)
# 256 colors support
# Use the first one
# set-option -g default-terminal 'screen-256color'
# set-option -sa terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[2 q'
# set-option -sa terminal-overrides ',screen-256color:RGB'
# set-option -sa terminal-features ',screen-256color:RGB'

# set-option -g default-terminal 'xterm-kitty'
# set-option -sa terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[2 q'
# set-option -sa terminal-overrides ',xterm-kitty:RGB'
# set-option -sa terminal-features ',xterm-kitty:RGB'

set-option -g default-terminal 'tmux-256color'
set-option -sa terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[2 q'
set-option -sa terminal-overrides ',xterm-256color:Tc'
# set-option -sa terminal-features ',xterm-kitty:RGB'

# sane scrolling
set -g mouse on

set -g renumber-windows on

# list of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'TheSast/tmux-nav-master'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'Morantron/tmux-fingers'
set -g @plugin 'omerxx/tmux-floax'
set -g @plugin 'trevarj/tmux-open-nvim'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @fingers-pattern-0 "(([.\\w\\-~\\$@]+)(\\/?[\\w\\-@]+)+\\/?)\\.([\\w]+)(:\\d*:\\d*)?"
set -g @fingers-ctrl-action "xargs -I {} tmux run-shell 'cd #{pane_current_path}; ~/.tmux/plugins/tmux-open-nvim/scripts/ton {} > ~/.tmux/plugins/tmux-open-nvim/ton.log'"s
# =================================================
# Floax
# Setting the main key to toggle the floating pane on and off
# set -g @floax-bind '<my-key>'

# When the pane is toggled, using this bind pops a menu with additional options
# such as resize, fullscreen, resetting to defaults and more.
set -g @floax-bind-menu 'P'

# The default width and height of the floating pane
set -g @floax-width '80%'
set -g @floax-height '80%'

# The border color can be changed, these are the colors supported by Tmux:
# black, red, green, yellow, blue, magenta, cyan, white for the standard
# terminal colors; brightred, brightyellow and so on for the bright variants;
# colour0/color0 to colour255/color255 for the colors from the 256-color
# palette; default for the default color; or a hexadecimal RGB color such as #882244.
set -g @floax-border-color 'magenta'

# The text color can also be changed, by default it's blue
# to distinguish from the main window
# Optional colors are as shown above in @floax-border-color
set -g @floax-text-color 'blue'

# By default when floax sees a change in session path
# it'll change the floating pane's path
# You can disable this by setting it to false
# You could also "cd -" when the pane is toggled to go back
set -g @floax-change-path 'true'

# The default session name of the floating pane is 'scratch'
# You can modify the session name with this option:
set -g @floax-session-name 'floax'

# Change the title of the floating window
set -g @floax-title 'floax'

# Session Manager
set -g @continuum-restore 'on'
set -g @ressurect-capture-pane-contents 'on'

# Setting vim keys in copy mode
setw -g mode-keys vi
bind -T copy-mode    C-c send -X copy-pipe-no-clear "xsel -i --clipboard"
bind -T copy-mode-vi C-c send -X copy-pipe-no-clear "xsel -i --clipboard"
bind-key -T copy-mode-vi y send -X copy-selection
bind-key -T copy-mode-vi v send -X begin-selection
bind p paste-buffer
bind -T copy-mode-vi Y send-keys -X copy-line
bind -T copy-mode-vi / command-prompt -i -p "(search down)" "send -X search-forward-incremental \"%%%\""
bind -T copy-mode-vi ? command-prompt -i -p "(search up)" "send -X search-backward-incremental \"%%%\""
bind -n MouseDown2Pane run "tmux set-buffer -b primary_selection \"$(xsel -o)\"; tmux paste-buffer -b primary_selection; tmux delete-buffer -b primary_selection"

# Themes plugins
# set -g @plugin 'egel/tmux-gruvbox'
# set -g @tmux-gruvbox 'dark'
# set -g @plugin 'dracula/tmux'
# set -g @plugin 'arcticicestudio/nord-tmux'
# set -g @plugin '2kabhishek/tmux2k'
# set -g @plugin 'niksingh710/minimal-tmux-status'
# set -g @plugin 'catppuccin/tmux'
# set -g @catppuccin_flavour 'mocha' # or frappe, macchiato, mocha
# set -g @catppuccin_window_default_fill "number"
# set -g @catppuccin_window_status_icon_enable "yes"
# set -g @catppuccin_window_status_enable "yes"
# set -g @catppuccin_icon_window_last "Û∞ñ∞ "
# set -g @catppuccin_icon_window_current "Û∞ñØ "
# set -g @catppuccin_icon_window_zoom "Û∞Åå "
# set -g @catppuccin_icon_window_mark "Û∞ÉÄ "
# set -g @catppuccin_icon_window_silent "Û∞Çõ "
# set -g @catppuccin_icon_window_activity "Û±Ö´ "
# set -g @catppuccin_icon_window_bell "Û∞Çû "
# # set -g @catppuccin_window_default_text "#{b:pane_current_path}"
# set -g @catppuccin_window_default_text "#W"
# set -g @catppuccin_window_current_text "#W" # use "#W" for application instead of directory
# set -g @catppuccin_window_current_format_directory_text "#{b:pane_current_path}"
# set -g @catppuccin_window_format_directory_text "#{b:pane_current_path}"
# set -g @catppuccin_directory_text "#{b:pane_current_path}"
# set -g @catppuccin_status_background "default"
# set -g @catppuccin_status_justify "absolute-centre"
# set -g @catppuccin_status_modules_right "directory session"
# set -g @catppuccin_status_modules_left "running_command"


# Status Line =========================================================
set -g focus-events on
set -g status-style bg=default
set -g status-left-length 90
set -g status-right-length 90
set-option -g status-position bottom
set -g status-justify left
# set -g status-right "üóÄ #{b:pane_current_path}"
set -g status-right "\uf365 #{b:session_name}   "
# set -g status-left "\uf365 #{b:session_name}   "
set -g status-left ""
set -g window-status-format "#[fg=default]#I#[default] #W"
set -g window-status-current-format "\uef4d #W \uef4d"
set -g window-status-current-style "fg=#ff4444 bg=default"
set -g window-status-style fg=#ECF0C1
set -g status-interval 5
set -g status-bg default
set -g message-command-style "bg=#222222 fg=#cccccc"
set -g message-style "bg=default fg=#ffffff"



set -g allow-passthrough on

set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM
# TMUX plugin manager (keep at the bottom of tmux.conf)
run -b '~/.tmux/plugins/tpm/tpm'
